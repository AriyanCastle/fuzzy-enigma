(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return r(3669)}])},3669:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return m}});var n=r(5893),o=r(7294),a=r(2593),s=r(8648),i=r(3977),l=r(8887),c=r(1259),d=r(9828);let u=(0,i.ZF)({apiKey:"AIzaSyCsFyM-hez55bCC2GKank-EP2jRARb-Z2Q",authDomain:"evidai.firebaseapp.com",projectId:"evidai",storageBucket:"evidai.appspot.com",messagingSenderId:"293626544065",appId:"1:293626544065:web:0fb4463212f1e9537eb940",measurementId:"G-122TDWLG36"}),h=(0,c.v0)(u);(0,d.ad)(u),(0,l.IH)(u);let p=(0,d.ad)(u);var g=e=>{let{signInWithGoogle:t}=e;return(0,n.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"100vh",textAlign:"center",gap:"20px"},children:[(0,n.jsx)("h2",{children:"中醫語音病歷輔助系統，請先註冊後使用"}),(0,n.jsx)("button",{onClick:t,style:{backgroundColor:"#4285f4",color:"white",padding:"10px 20px",borderRadius:"4px",border:"none",fontSize:"16px",cursor:"pointer"},children:"Sign In with Google"})]})};let f=async(e,t,r,n,o,a)=>{try{console.log("Firestore instance:",p);let s=(0,d.hJ)(p,"users");console.log("Users collection:",s);let i=(0,d.JU)(s,e);console.log("User document reference:",i);let l={inputForClinicalHistory:t,voiceRecording:r,transcribedText:n,summary:o,clinicalHistory:a,timestamp:new Date};await (0,d.pl)(i,l,{merge:!0}),console.log("User data saved successfully")}catch(e){console.error("Error saving user data:",e)}};var m=()=>{let{recording:e,speaking:t,transcribing:r,transcript:i,pauseRecording:l,startRecording:d,stopRecording:u}=(0,a.u)({apiKey:"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",streaming:!0,timeSlice:1e3,whisperConfig:{language:"zh",prompt:"用繁体轉錄香港中醫師與病人的廣東話診療內容"}}),[p,m]=(0,o.useState)(!1),[x,b]=(0,o.useState)(""),[y,w]=(0,o.useState)(""),[j,N]=(0,o.useState)(""),[v,C]=(0,o.useState)(null),S=async()=>{let e=new c.hJ;try{let t=await (0,c.rh)(h,e);C(t.user)}catch(e){console.log("Error signing in:",e)}};(0,o.useEffect)(()=>{let e=h.onAuthStateChanged(e=>{C(e)});return()=>e()},[]);let E=async()=>{if(v){let t=v.uid,r=i.text;await f(t,j,e,r,x,y)}else console.error("User not signed in")},[k,T]=(0,o.useState)(!1),_=async()=>{if("string"==typeof i.text){let e=await (0,s.gZ)(i.text);b(e),N(e)}else console.error("Error: transcript.text is not a string")},I=async()=>{if(T(!0),"string"==typeof j){let e=await (0,s.BA)(j);w(e),await E()}else console.error("Error: editedSummary is not a string");T(!1)};return(0,n.jsx)("div",{className:"container mx-auto px-4 py-8",children:v?(0,n.jsxs)("div",{className:"flex flex-col",children:[(0,n.jsx)("div",{className:"flex justify-center mb-6",children:(0,n.jsx)("button",{className:"".concat(p?"bg-red-600":"bg-blue-600"," text-white py-2 px-6 rounded focus:outline-none"),onClick:()=>{p?u():d(),m(!p)},children:p?"停止識別":"AI語音識別"})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"font-bold text-lg mb-4",children:"實時識別內容:"}),(0,n.jsx)("div",{className:"bg-blue-100 border border-gray-300 p-4 rounded mb-6 whitespace-pre-wrap",children:i.text}),(0,n.jsx)("button",{className:"bg-green-600 text-white py-2 px-6 rounded focus:outline-none float-right mb-6",onClick:_,children:"摘取重點"})]}),(0,n.jsxs)("div",{className:"flex",children:[(0,n.jsxs)("div",{className:"w-1/2 pr-2",children:[(0,n.jsx)("h3",{className:"font-bold text-lg mb-4",children:"對話重點:(請先修改並確認內容)"}),(0,n.jsx)("textarea",{className:"w-full h-28 p-4 border border-gray-300 rounded mb-6 resize-none",value:j,onChange:e=>{N(e.target.value)}})]}),(0,n.jsxs)("div",{className:"w-1/2 pl-2",children:[(0,n.jsx)("h3",{className:"font-bold text-lg mb-4",children:"筆記本:"}),(0,n.jsx)("textarea",{className:"w-full h-28 p-4 border border-gray-300 rounded mb-6 resize-none"})]})]}),(0,n.jsx)("button",{className:"bg-green-600 text-white py-2 px-6 rounded focus:outline-none float-right mb-6",onClick:I,disabled:k,children:k?"病史生成中...":"生成病史，需要將內容放入對話重點框"}),y&&(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"font-bold text-lg mb-4",children:"病史:"}),(0,n.jsx)("div",{className:"bg-blue-100 border border-gray-300 p-4 rounded mb-6 whitespace-pre-wrap",children:y})]})]}):(0,n.jsx)(g,{signInWithGoogle:S})})}},8648:function(e,t,r){"use strict";r.d(t,{BA:function(){return a},J$:function(){return o},gZ:function(){return n}});let n=async e=>{let t=await fetch("/api/generateSummary",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversation:e})});if(!t.ok){let e=await t.text();throw Error("Failed to generate summary: ".concat(e))}let r=await t.json();return r.summary};async function o(e,t){try{let r=await fetch("/api/langchainstream",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:e})});if(!r.ok){let e=await r.text();throw console.error("Error response:",e),Error("Failed to generate clinical history")}let n=[],o=r.body.pipeThrough(new TextDecoderStream).getReader();return new Promise((e,r)=>{o.read().then((function r(o){let{done:a,value:s}=o;if(a){e(n.join(""));return}return n.push(s),t(s),this.read().then(r.bind(this))}).bind(o)).catch(e=>{console.error("Error in fetchClinicalHistoryStream:",e),r(e)})})}catch(e){throw console.error("Error in fetchClinicalHistoryStream:",e),e}}async function a(e){try{let t=await fetch("/api/generateClinicalHistory",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({summary:e})});if(!t.ok){let e=await t.text();throw console.error("Error response:",e),Error("Failed to generate clinical history")}let r=await t.json();return r.history}catch(e){throw console.error("Error in fetchClinicalHistory:",e),e}}}},function(e){e.O(0,[16,551,21,774,888,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);